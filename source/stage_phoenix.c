
#include "stage_phoenix.h"
#include "stage_menu.h"
#include "../resources/phoenixware_tiles.h"
#include "../resources/luma_font.h"

extern const Colour lumapalette[];

const u16 phoenix_map[] = {
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	1,	2,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	3,	4,	5,	6,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	7,	8,	9,	10,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	15,	16,	17,	18,	19,	20,	21,	154,	154,	11,	12,	13,	14,	154,	154,	21 + SE_HFLIP,	20 + SE_HFLIP,	19 + SE_HFLIP,	18 + SE_HFLIP,	17 + SE_HFLIP,	16 + SE_HFLIP,	15 + SE_HFLIP,	154,	154,	154,	154,
154,	154,	22,	23,	24,	25,	26,	26,	26,	26,	29,	30,	31,	32,	33,	34,	35,	31 + SE_HFLIP,	30 + SE_HFLIP,	29 + SE_HFLIP,	26,	26,	26,	26,	25 + SE_HFLIP,	24 + SE_HFLIP,	23 + SE_HFLIP,	22 + SE_HFLIP,	154,	154,
36,	37,	38,	39,	26,	26,	26,	26,	26,	26,	26,	26,	26,	27,	28,	41,	42,	26,	26,	26,	26,	26,	26,	26,	26,	26,	39 + SE_HFLIP,	38 + SE_HFLIP,	37 + SE_HFLIP,	36 + SE_HFLIP,
43,	44,	45,	26,	46,	47,	48,	49,	50,	51,	52,	53,	54,	55,	56,	57,	58,	59,	60,	61,	62,	63,	64,	65,	66,	67,	26,	45 + SE_HFLIP,	44 + SE_HFLIP,	43 + SE_HFLIP,
68,	69,	70,	71,	72,	73,	74,	75,	76,	77,	78,	79,	80,	81,	82,	83,	84,	85,	86,	87,	88,	89,	90,	91,	92,	93,	71 + SE_HFLIP,	70 + SE_HFLIP,	69 + SE_HFLIP,	68 + SE_HFLIP,
94,	95,	96,	26,	97,	98,	99,	100,	101,	102,	103,	104,	105,	106,	107,	108,	109,	110,	111,	112,	113,	114,	115,	116,	117,	118,	26,	96 + SE_HFLIP,	95 + SE_HFLIP,	94 + SE_HFLIP,
119,	120,	121,	122,	123,	124,	125,	126,	127,	128,	129,	130,	131,	132,	133,	134,	135,	136,	137,	138,	139,	140,	141,	142,	143,	144,	122 + SE_HFLIP,	121 + SE_HFLIP,	120 + SE_HFLIP,	119 + SE_HFLIP,
154,	145,	154,	146,	26,	147,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	147 + SE_HFLIP,	26,	146 + SE_HFLIP,	154,	145 + SE_HFLIP,	154,
154,	148,	154,	149,	150,	151,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	151 + SE_HFLIP,	150 + SE_HFLIP,	149 + SE_HFLIP,	154,	148 + SE_HFLIP,	154,
154,	154,	154,	154,	152,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	152 + SE_HFLIP,	154,	154,	154,	154,
154,	154,	154,	154,	153,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	153 + SE_HFLIP,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,
154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,	154,

};

const Colour phoenix_pal[] = {
    { 40, 7, 40 },
    { 40, 36, 7 },
    { 40, 27, 7 },
    { 40, 20, 7 },
    { 41, 7, 5 },
    { 44, 44, 44 },
    { 9, 19, 44 },
    { 45, 8, 5 },
    { 0, 45, 23 },
    { 51, 8, 6 },
    { 4, 28, 50 },
    { 56, 56, 56 },
    { 38, 57, 15 },
    { 55, 6, 40 },
    { 58, 46, 10 },
    { 58, 10, 7 },
    { 1, 41, 59 },
    { 61, 10, 8 },
    { 0, 48, 63 },
    { 0, 48, 64 },
    { 67, 11, 8 },
    { 67, 6, 37 },
    { 68, 60, 59 },
    { 54, 69, 17 },
    { 70, 49, 12 },
    { 69, 23, 12 },
    { 68, 6, 23 },
    { 71, 71, 71 },
    { 71, 39, 12 },
    { 76, 13, 9 },
    { 78, 10, 7 },
    { 82, 14, 10 },
    { 83, 83, 83 },
    { 85, 58, 57 },
    { 86, 86, 48 },
    { 86, 19, 15 },
    { 88, 15, 11 },
    { 92, 92, 92 },
    { 13, 41, 92 },
    { 92, 16, 11 },
    { 94, 81, 46 },
    { 84, 94, 24 },
    { 46, 30, 98 },
    { 55, 27, 97 },
    { 72, 23, 97 },
    { 89, 20, 97 },
    { 38, 34, 100 },
    { 30, 35, 100 },
    { 99, 17, 12 },
    { 102, 102, 102 },
    { 26, 43, 105 },
    { 105, 18, 98 },
    { 108, 37, 18 },
    { 107, 18, 13 },
    { 109, 36, 80 },
    { 21, 50, 109 },
    { 43, 113, 61 },
    { 18, 54, 113 },
    { 113, 22, 16 },
    { 73, 62, 115 },
    { 54, 116, 40 },
    { 92, 38, 116 },
    { 115, 57, 25 },
    { 115, 20, 14 },
    { 118, 53, 50 },
    { 118, 44, 40 },
    { 15, 60, 117 },
    { 119, 119, 119 },
    { 57, 100, 120 },
    { 92, 36, 121 },
    { 99, 34, 120 },
    { 106, 33, 120 },
    { 112, 32, 121 },
    { 120, 17, 99 },
    { 121, 21, 15 },
    { 1, 120, 63 },
    { 123, 69, 66 },
    { 56, 123, 66 },
    { 36, 102, 123 },
    { 115, 123, 30 },
    { 123, 30, 121 },
    { 11, 70, 123 },
    { 125, 21, 16 },
    { 0, 124, 65 },
    { 128, 121, 121 },
    { 43, 128, 69 },
    { 63, 53, 129 },
    { 131, 36, 24 },
    { 130, 22, 16 },
    { 129, 21, 15 },
    { 3, 131, 69 },
    { 62, 132, 49 },
    { 19, 133, 71 },
    { 135, 135, 135 },
    { 134, 111, 110 },
    { 134, 28, 121 },
    { 134, 24, 16 },
    { 136, 16, 99 },
    { 7, 87, 135 },
    { 138, 35, 35 },
    { 138, 30, 31 },
    { 27, 137, 73 },
    { 32, 141, 72 },
    { 140, 24, 17 },
    { 141, 22, 16 },
    { 39, 144, 71 },
    { 31, 144, 78 },
    { 142, 28, 122 },
    { 142, 97, 24 },
    { 142, 20, 13 },
    { 5, 98, 143 },
    { 47, 146, 70 },
    { 146, 48, 43 },
    { 145, 25, 18 },
    { 146, 16, 99 },
    { 146, 22, 16 },
    { 145, 19, 13 },
    { 76, 148, 59 },
    { 148, 33, 30 },
    { 149, 27, 122 },
    { 13, 148, 78 },
    { 148, 25, 14 },
    { 14, 149, 80 },
    { 2, 106, 148 },
    { 151, 151, 151 },
    { 55, 150, 69 },
    { 151, 45, 43 },
    { 151, 40, 36 },
    { 150, 104, 28 },
    { 71, 153, 64 },
    { 63, 153, 67 },
    { 154, 48, 44 },
    { 148, 153, 35 },
    { 153, 26, 19 },
    { 152, 20, 16 },
    { 152, 20, 13 },
    { 155, 100, 32 },
    { 155, 15, 96 },
    { 0, 116, 155 },
    { 159, 126, 125 },
    { 157, 32, 32 },
    { 159, 71, 30 },
    { 159, 53, 30 },
    { 158, 43, 30 },
    { 158, 37, 30 },
    { 157, 26, 122 },
    { 157, 22, 39 },
    { 157, 16, 50 },
    { 157, 15, 57 },
    { 157, 15, 71 },
    { 157, 15, 87 },
    { 161, 62, 58 },
    { 160, 87, 30 },
    { 164, 25, 123 },
    { 166, 166, 166 },
    { 168, 76, 72 },
    { 23, 95, 168 },
    { 171, 25, 122 },
    { 170, 16, 81 },
    { 170, 16, 88 },
    { 177, 94, 90 },
    { 9, 113, 176 },
    { 178, 175, 40 },
    { 178, 24, 122 },
    { 179, 17, 93 },
    { 182, 108, 105 },
    { 180, 100, 96 },
    { 180, 17, 80 },
    { 183, 183, 183 },
    { 7, 132, 184 },
    { 185, 113, 111 },
    { 187, 24, 122 },
    { 188, 19, 75 },
    { 6, 153, 188 },
    { 192, 20, 97 },
    { 197, 23, 122 },
    { 200, 200, 200 },
    { 200, 144, 142 },
    { 199, 181, 42 },
    { 202, 23, 121 },
    { 205, 153, 151 },
    { 205, 183, 43 },
    { 203, 22, 74 },
    { 205, 22, 103 },
    { 205, 22, 115 },
    { 207, 184, 42 },
    { 207, 60, 41 },
    { 207, 51, 41 },
    { 206, 43, 42 },
    { 206, 36, 45 },
    { 206, 32, 49 },
    { 206, 29, 53 },
    { 206, 25, 59 },
    { 206, 24, 64 },
    { 206, 22, 69 },
    { 206, 22, 107 },
    { 207, 208, 208 },
    { 208, 184, 41 },
    { 209, 180, 41 },
    { 210, 171, 41 },
    { 210, 164, 41 },
    { 210, 157, 41 },
    { 210, 150, 41 },
    { 210, 142, 41 },
    { 210, 134, 41 },
    { 210, 126, 41 },
    { 210, 118, 41 },
    { 210, 110, 41 },
    { 210, 102, 41 },
    { 209, 94, 41 },
    { 209, 87, 41 },
    { 208, 76, 41 },
    { 208, 66, 41 },
    { 211, 211, 211 },
    { 219, 219, 219 },
    { 224, 194, 193 },
    { 227, 227, 227 },
    { 232, 210, 209 },
    { 231, 208, 207 },
    { 231, 207, 206 },
    { 235, 235, 235 },
    { 237, 220, 220 },
    { 244, 244, 244 },
    { 253, 253, 253 },
};


void phoenix_start()
{
    graphics_palette_set( (Colour*)phoenix_pal, 32, 224 );
    graphics_tilemap_characterset_set((u8*)phoenixware_tiles, 1, 155, COLOURS_8BPP);
}

void phoenix_finish()
{
    graphics_palette_set( (Colour*)lumapalette, 0, 107 );
    graphics_tilemap_characterset_set((u8*)luma_font, 0, 493, COLOURS_8BPP);
}

void phoenix_update()
{
	if(engine_stage_time >= 160)
	{
		engine_changestage((StageRecord*)&mainmenu_stage);
		return;
	}

	if(engine_stage_time < 20)
	{
        u8 y = engine_stage_time;
        for(int x = 0; x < 30; x++)
        {
            graphics_tilemap_tilemap_settile(0, x, y, phoenix_map[(y * 30) + x]);
        }
	}
	else if (engine_stage_time >= 140)
	{
        for(int x = 0; x < 30; x++)
        {
            graphics_tilemap_tilemap_settile(0, x, engine_stage_time - 140, 0);
        }
	}
}
